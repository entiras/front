// loader message
var loader={};loader.active=!1,loader.show=function(){loader.active=!0,setTimeout(loader.wait,500)},loader.hide=function(){loader.active=!1,$('#loader').addClass('d-none')},loader.wait=function(){loader.active&&$('#loader').removeClass('d-none')};// check if logged
var login={};login.logged=!1,login.check=function(){var a=Cookies.get('user');a===void 0?login.logged=!1:(login.logged=!0,$('#username').text(a)),login.checked()},login.checked=function(){login.logged?content.logged():content.guest()};// show content
var content={logged:function(){$('.logged').removeClass('d-none')},guest:function(){$('.guest').removeClass('d-none')}},actions={};// actions
actions.failed=function(){$('#network-err').removeClass('d-none')},actions.csrf=function(a){$.ajax({type:'GET',url:'/api/csrf',success:a,error:actions.failed})},actions.form=function(a){for(var b=$(a).serializeArray(),c={},d=0;d<b.length;d++)c[b[d].name]=b[d].value;return c},actions.redirect=function(a){setTimeout(a=>{window.location.href=a},500,a)},actions.logout=function(){actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#logout');$.ajax({type:'POST',url:'/api/logout',data:b,error:actions.failed,success:()=>{actions.redirect('/')}})})},actions.login=function(a){a.preventDefault(),$('#login :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#login');$.ajax({type:'POST',url:'/api/login',data:b,error:actions.failed,success:a=>{if($('#login :submit').prop('disabled',!1),'validation'===a.message){var b=a.error.field,c=a.error.validation;$('#'+b+'-'+c).removeClass('d-none'),$('input[name='+b+']').addClass('is-invalid')}else'credentials'===a.message?($('#credentials').removeClass('d-none'),$('input[name=username]').addClass('is-invalid'),$('input[name=password]').addClass('is-invalid')):'unconfirmed'===a.message?$('#unconfirmed').removeClass('d-none'):'logged'===a.message&&($('#logged').removeClass('d-none'),actions.redirect('/'))}})})},actions.signup=function(a){a.preventDefault(),$('#signup :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#signup');$.ajax({type:'POST',url:'/api/signup',data:b,error:actions.failed,success:a=>{if($('#signup :submit').prop('disabled',!1),'validation'===a.message){var b=a.error.field,c=a.error.validation;$('#'+b+'-'+c).removeClass('d-none'),$('input[name='+b+']').addClass('is-invalid')}else'url'===a.message?($('#username-url').removeClass('d-none'),$('input[name=username]').addClass('is-invalid')):'clone'===a.message?($('#clone').removeClass('d-none'),$('input[name=username]').addClass('is-invalid'),$('input[name=email]').addClass('is-invalid')):'sent'===a.message&&($('#sent').removeClass('d-none'),actions.redirect('/signup/confirm/'))}})})},actions.confirm=function(a){a.preventDefault(),$('#confirm :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#confirm');$.ajax({type:'POST',url:'/api/signup/confirm',data:b,error:actions.failed,success:a=>{$('#confirm :submit').prop('disabled',!1),'danger'===a.type?$('input[name=token]').addClass('is-invalid'):actions.redirect('/login/'),$('#'+a.message).removeClass('d-none')}})})},actions.resend=function(a){a.preventDefault(),$('#resend :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#resend');$.ajax({type:'POST',url:'/api/signup/resend',data:b,error:actions.failed,success:a=>{$('#resend :submit').prop('disabled',!1),'required'===a.message||'email'===a.message?$('input[name=email]').addClass('is-invalid'):'captcha'===a.message&&$('input[name=captcha]').addClass('is-invalid'),$('#'+a.message).removeClass('d-none'),'sent'===a.message&&actions.redirect('/signup/confirm/'),'sent'!==a.message&&$('#_captcha').attr('src','/api/captcha?'+Math.random())}})})},actions.forgot=function(a){a.preventDefault(),$('#forgot :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#forgot');$.ajax({type:'POST',url:'/api/login/forgot',data:b,error:actions.failed,success:a=>{$('#forgot :submit').prop('disabled',!1),'required'===a.message||'email'===a.message?$('input[name=email]').addClass('is-invalid'):'captcha'===a.message&&$('input[name=captcha]').addClass('is-invalid'),$('#'+a.message).removeClass('d-none'),'sent'===a.message&&actions.redirect('/login/reset/'),'sent'!==a.message&&$('#_captcha').attr('src','/api/captcha?'+Math.random())}})})},actions.reset=function(a){a.preventDefault(),$('#reset :submit').prop('disabled',!0),$('.alert').addClass('d-none'),$('input').removeClass('is-invalid'),actions.csrf(a=>{$('input[name=_csrf]').val(a.token);var b=actions.form('#reset');console.log(b),$.ajax({type:'POST',url:'/api/login/reset',data:b,error:actions.failed,success:a=>{$('#reset :submit').prop('disabled',!1),'danger'!==a.type&&actions.redirect('/login/'),'required'===a.message||'min'===a.message?$('input[name=password]').addClass('is-invalid'):'invalid'===a.message&&$('input[name=token]').addClass('is-invalid'),$('#'+a.message).removeClass('d-none')}})})},$(document).ready(function(){login.check()}),$.ajaxSetup({beforeSend:loader.show,complete:loader.hide});